# 第四章
---
## 4.2 文字模式下指令的下達
**文字模式登入後所取得的程式被稱為殼(Shell)**
### 4.2.1 開始下達指令
>[dmtsai@study ~]$ command  [-options]  parameter1  parameter2 ...
>
>                       指令     選項        參數(1)     參數(2)

0. 一行指令中第一個輸入的部分絕對是『指令(command)』或『可執行檔案(例如批次腳本,script)』
1. command 為指令的名稱，例如變換工作目錄的指令為 cd 等等；
2. 中刮號[]並不存在於實際的指令中，而加入選項設定時，通常選項前會帶 - 號，例如 -h；有時候會使用選項的完整全名，則選項前帶有 -- 符號，例如 --help；
3. parameter1 parameter2.. 為依附在選項後面的參數，或者是 command 的參數；
4. 指令, 選項, 參數等這幾個咚咚中間以空格來區分，**不論空幾格 shell 都視為一格**。所以空格是很重要的特殊字元！；
5. 按下[Enter]按鍵後，該指令就立即執行。[Enter]按鍵代表著一行指令的開始啟動。
6. 指令太長的時候，可以使用反斜線 (\) 來跳脫[Enter]符號，使指令連續到下一行。注意！反斜線後就立刻接特殊字符，才能跳脫！
7. 其他：
a. 在 Linux 系統中，英文大小寫字母是不一樣的。舉例來說， cd 與 CD 並不同。
b. 更多的介紹等到第十章 bash 時，再來詳述。

### 4.2.2 基礎指令的操作
1. data 

kevin@ubuntu:~$ date
Tue Oct 18 16:23:26 CST 2022

kevin@ubuntu:~/os/os_experiment/uCore-Tutorial-Code-2022S$ date +%Y/%m/%d
2022/10/18

2. cal


3. 簡單好用的計算機： bc
在上表當中，粗體字表示輸入的資料，而在每個粗體字的底下就是輸出的結果。 咦！每個計算都還算正確，怎麼10/100會變成0呢？這是因為bc預設僅輸出整數，如果要輸出小數點下位數，那麼就必須要執行 scale=number ，那個number就是小數點位數，例如：

- 一種是該指令會直接顯示結果然後回到命令提示字元等待下一個指令的輸入；
- 一種是進入到該指令的環境，直到結束該指令才回到命令提示字元的環境。

### 4.2.3 重要的幾個熱鍵[Tab], [ctrl]-c, [ctrl]-d
#### [Tab]按鍵
**他具有『命令補全』與『檔案補齊』的功能喔！**

- [Tab] 接在一串指令的第一個字的後面，則為『命令補全』； 
- [Tab] 接在一串指令的第二個字以後時，則為『檔案補齊』！
- 若安裝 bash-completion 軟體，則在某些指令後面使用 [tab] 按鍵時，可以進行『選項/參數的補齊』功能！

#### [Ctrl]-c 按鍵
**中斷目前程式的按鍵啦** 

#### [Ctrl]-d 按鍵
這個組合按鍵通常代表著： 『鍵盤輸入結束(End Of File, EOF 或 End Of Input)』的意思！ 另外，他也可以用來取代exit的輸入呢！例如你想要直接離開文字介面，可以直接按下[Ctrl]-d就能夠直接離開了(相當於輸入exit啊！)。

#### [shift]+{[PageUP]|[Page Down]}按鍵
你可以使用 [Shift]+[Page Up] 來往前翻頁，也能夠使用 [Shift]+[Page Down] 來往後翻頁！

### 4.2.4 錯誤訊息的察看
藉由螢幕上面顯示的錯誤訊息來瞭解你的問題點

---

## 4.3 Linux系統的線上求助man page與info page
### 4.3.1 指令的 --help 求助說明


### 4.3.2 man page
kevin@ubuntu:~$ man cmake

#### 搜尋特定指令/檔案的man page說明文件
>在某些情況下，你可能知道要使用某些特定的指令或者是修改某些特定的設定檔，但是偏偏忘記了該指令的完整名稱。 有些時候則是你只記得該指令的部分關鍵字。這個時候你要如何查出來你所想要知道的man page呢？ 我們以底下的幾個例子來說明man這個指令有用的地方喔！

kevin@ubuntu:~$ man -f man
man (7)              - macros to format man pages
man (1)              - an interface to the on-line reference manuals

>好了，那麼萬一我真的忘記了下達數字，只有輸入『 man man 』時，那麼取出的資料到底是1還是7啊？ 這個就跟搜尋的順序有關了。搜尋的順序是記錄在/etc/man_db.conf 這個設定檔當中， 先搜尋到的那個說明檔，就會先被顯示出來！ 一般來說，通常會先找到數字較小的那個啦！因為排序的關係啊！所以， man man 會跟 man 1 man 結果相同！

### 4.3.3 info page
info 命令
在所有的Unix Like系統當中，都可以利用 man 來查詢指令或者是相關檔案的用法； 但是，在Linux裡面則又額外提供了一種線上求助的方法，那就是利用info這個好用的傢伙啦！
基本上，info與man的用途其實差不多，都是用來查詢指令的用法或者是檔案的格式。但是與man page一口氣輸出一堆資訊不同的是，info page則是將文件資料拆成一個一個的段落，每個段落用自己的頁面來撰寫， 並且在各個頁面中還有類似網頁的『超連結』來跳到各不同的頁面中，每個獨立的頁面也被稱為一個節點(node)。 所以，你可以將info page想成是文字模式的網頁顯示資料啦！

### 4.3.4 其他有用的文件(documents)
那麼這些說明文件要擺在哪裡呢？哈哈！就是擺在/usr/share/doc這個目錄啦！所以說，你只要到這個目錄底下， 就會發現好多好多的說明文件檔啦！還不需要到網路上面找資料呢！厲害吧！^_^ 舉例來說，你可能會先想要知道 grub2 這個新版的開機管理軟體有什麼能使用的指令？那可以到底下的目錄瞧瞧：

另外，很多原版軟體釋出的時候，都會有一些安裝須知、預計工作事項、未來工作規劃等等的東西，還有包括可安裝的程序等， 這些檔案也都放置在 /usr/share/doc 當中喔！而且/usr/share/doc這個目錄下的資料主要是以套件(packages)為主的

總結上面的三個咚咚(man, info, /usr/share/doc/)，請記住喔：
- 在終端機模式中，如果你知道某個指令，但卻忘記了相關選項與參數，請先善用 --help 的功能來查詢相關資訊；
- 當有任何你不知道的指令或檔案格式這種玩意兒，但是你想要瞭解他，請趕快使用man或者是info來查詢！
- 而如果你想要架設一些其他的服務，或想要利用一整組軟體來達成某項功能時，請趕快到/usr/share/doc 底下查一查有沒有該服務的說明檔喔！

## 4.4 超簡單文書編輯器： nano
kevin@ubuntu:~/git_learn$ nano text.txt
- **[ctrl]-X：離開nano軟體，若有修改過檔案會提示是否需要儲存喔！** 
- [ctrl]-G：取得線上說明(help)，很有用的！
- [ctrl]-O：儲存檔案，若你有權限的話就能夠儲存檔案了；
- [ctrl]-R：從其他檔案讀入資料，可以將某個檔案的內容貼在本檔案中；
- [ctrl]-W：搜尋字串，這個也是很有幫助的指令喔！
- [ctrl]-C：說明目前游標所在處的行數與列數等資訊；
- [ctrl]-_：可以直接輸入行號，讓游標快速移動到該行；
- [alt]-Y：校正語法功能開啟或關閉(按一下開、再按一下關)
- [alt]-M：可以支援滑鼠來移動游標的功能

## 4.5 正確的關機方法

在當時我們關掉DOS的系統時，常常是直接關掉電源開關，而 Windows 在你不爽的時候，按著電源開關四秒也可以關機！但是在Linux則相當的不建議這麼做！
Why？在 Windows (非 NT 主機系統) 系統中，由於是單人假多工的情況，所以即使你的電腦關機， 對於別人應該不會有影響才對！不過呢，在 Linux 底下，由於每個程序 (或者說是服務) 都是在在背景下執行的，因此，在你看不到的螢幕背後其實可能有相當多人同時在你的主機上面工作， 例如瀏覽網頁啦、傳送信件啦以 FTP 傳送檔案啦等等的，如果你直接按下電源開關來關機時， 則其他人的資料可能就此中斷！那可就傷腦筋了！

- 觀察系統的使用狀態：

    如果要看目前有誰在線上，可以下達『who』這個指令
    kevin@ubuntu:~/git_learn$ who
    kevin    :0           2022-10-19 10:35 (:0)

    如果要看網路的連線狀態，可以下達 『 netstat -a 』這個指令

    而要看背景執行的程序可以執行『 ps -aux 』這個指令

- 通知線上使用者關機的時刻：
    要關機前總得給線上的使用者一些時間來結束他們的工作，所以，這個時候你可以使用 shutdown 的特別指令來達到此一功能。

- 正確的關機指令使用：

    例如 shutdown 與 reboot 兩個指令！

#### 資料同步寫入磁碟： sync

因此在Linux系統中，為了加快資料的讀取速度，所以在預設的情況中， 某些已經載入記憶體中的資料將不會直接被寫回硬碟，而是先暫存在記憶體當中，如此一來， 如果一個資料被你重複的改寫，那麼由於他尚未被寫入硬碟中，因此可以直接由記憶體當中讀取出來， 在速度上一定是快上相當多的！

不過，如此一來也造成些許的困擾，那就是萬一你的系統因為某些特殊情況造成不正常關機 (例如停電或者是不小心踢到power)時，由於資料尚未被寫入硬碟當中，哇！所以就會造成資料的更新不正常啦！ 那要怎麼辦呢？這個時候就需要sync這個指令來進行資料的寫入動作啦！ 直接在文字介面下輸入sync，那麼在記憶體中尚未被更新的資料，就會被寫入硬碟中！所以，這個指令在系統關機或重新開機之前， 很重要喔！最好多執行幾次！

kevin@ubuntu:~/os$ sync
//资料同步

#### 慣用的關機指令： shutdown
由於Linux的關機是那麼重要的工作，因此除了你是在主機前面以實體終端機 (tty1~tty7) 來登入系統時， 不論用什麼身份都能夠關機之外，若你是使用遠端管理工具(如透過pietty使用ssh服務來從其他電腦登入主機)， 那關機就只有root有權力而已喔！
嗯！那麼就來關機試試看吧！我們較常使用的是shutdown這個指令，而這個指令會通知系統內的各個程序 (processes)，並且將通知系統中的一些服務來關閉。shutdown可以達成如下的工作：
- 可以自由選擇關機模式：是要關機或重新開機均可；
- 可以設定關機時間: 可以設定成現在立刻關機, 也可以設定某一個特定的時間才關機。
- 可以自訂關機訊息：在關機之前，可以將自己設定的訊息傳送給線上 user 。
- 可以僅發出警告訊息：有時有可能你要進行一些測試，而不想讓其他的使用者干擾，或者是明白的告訴-使用者某段時間要注意一下！這個時候可以使用 shutdown 來嚇一嚇使用者，但卻不是真的要關機啦！

> [root@study ~]# /sbin/shutdown [-krhc] [時間] [警告訊息]
選項與參數：
-k     ： 不要真的關機，只是發送警告訊息出去！
-r     ： 在將系統的服務停掉之後就重新開機(常用)
-h     ： 將系統的服務停掉後，立即關機。 (常用)
-c     ： 取消已經在進行的 shutdown 指令內容。
時間   ： 指定系統關機的時間！時間的範例底下會說明。若沒有這個項目，則預設 1 分鐘後自動進行。

#### 重新開機，關機： reboot, halt, poweroff
[root@study ~]# halt      # 系統停止～螢幕可能會保留系統已經停止的訊息！
[root@study ~]# poweroff  # 系統關機，所以沒有提供額外的電力，螢幕空白！


## 4.6 重點回顧
- 為了避免瞬間斷電造成的Linux系統危害，建議做為伺服器的Linux主機應該加上不斷電系統來持續提供穩定的電力；
- 養成良好的操作習慣，盡量不要使用 root 直接登入系統，應使用一般帳號登入系統，有需要再轉換身份
- 可以透過『活動總覽』查看系統所有使用的軟體及快速啟用慣用軟體
- 在X的環境下想要『強制』重新啟動X的組合按鍵為：『[alt]+[ctrl]+[backspace]』；
- 預設情況下，Linux提供tty1~tty6的終端機界面；
- **在終端機環境中，可依據提示字元為$或#判斷為一般帳號或root帳號；**
- 取得終端機支援的語系資料可下達『echo $LANG』或『locale』指令；
- date可顯示日期、cal可顯示日曆、bc可以做為計算機軟體；
- 組合按鍵中，[tab]按鍵可做為(1)命令補齊或(2)檔名補齊或(3)參數選項補齊，[ctrl]-[c]可以中斷目前正在運作中的程式；
- Linux 系統上的英文大小寫為不同的資料
- 線上說明系統有man及info兩個常見的指令；
- man page說明後面的數字中，1代表一般帳號可用指令，8代表系統管理員常用指令，5代表系統設定檔格式；
- info page可將一份說明文件拆成多個節點(node)顯示，並具有類似超連結的功能，增加易讀性；
- 系統需正確的關機比較不容易損壞，可使用shutdown, poweroff等指令關機。